# 42장 비동기 프로그래밍

## 동기 처리와 비동기 처리

### 동기

한번 시작한 작업은 다 처리하고 나서야, 다음 코드로 넘어가는, 우리에게 익숙한 방식의 실행은 **'동기 실행'**이라고 한다.

### 비동기

특정 작업을 시작(리퀘스트 보내기)하고 완벽하게 다 처리(리스폰스를 받아서 처리)하기 전에, 실행 흐름이 바로 다음 코드로 넘어가고, 나중에 콜백이 실행되는 것을 **'비동기 실행'**이라고 한다.

### 비동기 실행'이라는 건 왜 존재하는 걸까?

보통 '비동기 실행'이 '동기 실행'에 비해, **동일한 작업을 더 빠른 시간 내에 처리**할 수 있기 때문

![Untitled](42%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%87%E1%85%B5%E1%84%83%E1%85%A9%E1%86%BC%E1%84%80%E1%85%B5%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%80%E1%85%B3%E1%84%85%E1%85%A2%E1%84%86%E1%85%B5%E1%86%BC%208376bf1eaddf44e08d96bfc07e4b1396/Untitled.png)

동기 실행에서는 모든 작업이 순차적으로 수행되고 있고, 비동기 실행에서는 리스폰스를 기다리는 시간 동안 그 이후의 작업을 미리 처리하고 있다. 그래서 비동기 실행이 최종 작업 종료 시간이 더 짧다는 것을 알 수 있다.

### 자바스크립트에서의 비동기 처리 방식으로 동작하는 것들

- setTimeout
- setInterval
- HTTP 요청
- 이벤트 핸들러

## 이벤트 루프와 태스크 큐

### 이벤트 루프

자바스크립트는 싱글 스레드로 동작한다.(싱글 스레드: 한 번에 하나의 태스크만 처리)

하지만 브라우저를 보면 많은 태스크가 동시에 처리되는 것처럼 느껴진다. 자바스크립트의 동시성을 지원하는 것이 바로 이벤트 루프다.

![스크린샷 2024-04-17 오후 5.36.55.png](42%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%87%E1%85%B5%E1%84%83%E1%85%A9%E1%86%BC%E1%84%80%E1%85%B5%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%80%E1%85%B3%E1%84%85%E1%85%A2%E1%84%86%E1%85%B5%E1%86%BC%208376bf1eaddf44e08d96bfc07e4b1396/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-04-17_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_5.36.55.png)

구글의 V8 자바스클비트 엔진을 비롯한 대부분의 자바스크립트 엔진은 크게 2개의 영역으로 구분된다.

![스크린샷 2024-04-17 오후 5.37.13.png](42%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%87%E1%85%B5%E1%84%83%E1%85%A9%E1%86%BC%E1%84%80%E1%85%B5%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%80%E1%85%B3%E1%84%85%E1%85%A2%E1%84%86%E1%85%B5%E1%86%BC%208376bf1eaddf44e08d96bfc07e4b1396/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-04-17_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_5.37.13.png)

자바스크립트 엔진은 단순히 태스크가 요청되면 콜 스택을 통해 요청된 작업을 순차적으로 실행할 뿐이다. 

비동기 처리에서 소스코드의 평가와 실행을 제외한 모든 처리는 브라우저 또는 Node.js가 담당한다.

이를 위해 브라우저 환경은 태스크 큐와 이벤트 루프를 제공한다.

![스크린샷 2024-04-17 오후 5.39.11.png](42%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%87%E1%85%B5%E1%84%83%E1%85%A9%E1%86%BC%E1%84%80%E1%85%B5%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%80%E1%85%B3%E1%84%85%E1%85%A2%E1%84%86%E1%85%B5%E1%86%BC%208376bf1eaddf44e08d96bfc07e4b1396/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-04-17_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_5.39.11.png)

**비동기 함수는 태스크 큐에 푸시되어 대기하다가 콜 스택이 비게 되면, 다시 말해 전역 코드 및 명시적으로 호출된 함수가 모두 종료하면 비로소 콜 스택에 푸시되어 실행된다.**

자바스크립트는 싱글 스레드 방식으로 동작한다. 이때 싱글 방식으로  동작하는 것은 브라우저가 아니라 브라우저에 내장된 자바스크립트 엔진이라는 것에 주의하자. 만약 모든 자바스크립트 코드가 자바스크립트 엔진에서 싱글 스레드 방식으로 동작한다면 자바스크립트는 비동기로 동작할 수 없다. 즉, **자바스크립트 엔진은 싱글 스레드로 동작하지만 브라우저는 멀티 스레드로 동작한다.**

# 43장 Ajax

초창기의 웹은 특정 웹 페이지에서 다른 웹 페이지로 갈 수 있는 링크(공식 명칭은 hyperlink입니다)를 클릭하면 **새로운 웹 페이지가 로드**되는 방식이었다. 하지만 화면의 일부분만 바뀌면 되는 경우에도 **매번 새 페이지가 로드되는 방식**은 효율적이지도 않고 사용자에게도 그다지 좋지 않은 경험을 안겨주었다. 그래서 2000년대 초부터는 웹의 이런 단점을 극복하기 위해서 **Ajax**라는 기술이 도입

Ajax는 웹 브라우저가 **현재 페이지를 그대로 유지한 채로 서버에 리퀘스트를 보내고 리스폰스를 받아서**, 새로운 페이지를 로드하지 않고도 변화를 줄 수 있게 해주는 기술이다.

Ajax는 자바스크립트를 사용해서 비동기적으로(=사용자가 보고 있는 현재 화면에 영향을 미치지 않고 별도로 백그라운드에서 작업을 처리한다는 뜻) 리퀘스트를 보내고 리스폰스를 받는데 기반이 되는 기술들의 집합을 의미한다. 

### Ajax의 장점(전통적인 방식과 비교해서)

- 변경할 부분을 갱신하는 데 필요한 데이터만 서버로부터 전송받기 때문에 불필요한 데이터 통신이 발생하지 않는다.
- 변경할 필요가 없는 부분은 다시 렌더링하지 않는다. 따라서 화면이 순간적으로 깜빡이는 현상이 발생하지 않는다.
- 클라이언트와 서버와의 통신이 비동기 방식으로 동작하기 때문에 서버에게 요청을 보낸 이후 블로킹이 발생하지 않는다.

## JSON

JSON은 클라이언트와 서버 간의 HTTP 통신을 위한 텍스트 데이터 포맷이다.

### JSON 표기 방식

![스크린샷 2024-04-17 오후 5.47.28.png](42%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%87%E1%85%B5%E1%84%83%E1%85%A9%E1%86%BC%E1%84%80%E1%85%B5%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%80%E1%85%B3%E1%84%85%E1%85%A2%E1%84%86%E1%85%B5%E1%86%BC%208376bf1eaddf44e08d96bfc07e4b1396/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-04-17_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_5.47.28.png)

### JSON.stringify

객체를 JSON 포맷의 문자열로 변환

클라이언트가 서버로 객체를 전송하려면 객체를 문자열화해야 하는데 이를 직렬화라 한다.

### JSON.parse

JSON 포맷의 문자열을 객체로 변환

서버로부터 클라이언트에게 전송된 JSON 데이터는 문자열이다. 이 문자열을 객체로서 사용하려면 JSON 포맷의 문자열을 객체화해야 하는데 이를 역직렬화라 한다.

## XMLHttpRequest

자바스크립트에서는 **XMLHttpRequest**라고 하는 객체를 통해 Ajax 통신을 할 수 있다. XMLHttpRequest를 사용하는 예시 코드는 다음과 같다.

```jsx
const xhr = new XMLHttpRequest();
xhr.open('GET', 'https://example.com/api/members');
xhr.onload = function () {
  console.log(xhr.response);
};
xhr.onerror = function () {
  alert('Error!');
};
xhr.send();
```

XMLHttpRequest의 사용법을 자세히 알아야 할 때 모던자바스크립트 43장 Ajax를 참고하자.

그런데 예전엔 XMLHttpRequest를 이렇게 직접 사용할 일이 많았지만 요즘에는 굳이 그렇게 하지 않아도 된다. 그 이유에는 크게 두 가지가 있다.

- XMLHttpRequest 객체 이후에 등장한 함수, 바로 이때까지 **우리가 배운 fetch 함수를 사용해서 Ajax 통신을 할 수 있기 때문**
- XMLHttpRequest을 기반으로 더 쓰기 편하게 만들어진 **axios라는 패키지**가 존재하기 때

**개발 실무에서는 fetch 함수 또는 axios 패키지를 사용한다.** 보통 axios 패키지에 좀더 다양한 기능들이 있어서 주로 axios를 쓰는 편이지만, 외부의 패키지를 설치하고 싶지 않은 경우에는 fetch 함수를 사용하기도 한다.
